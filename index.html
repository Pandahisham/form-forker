<!DOCTYPE html>
<html>
  <head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js"></script>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <div id="branching-form">
      <h1>Weee branching form</h1>

      <!-- Level 0 form field: person_age -->
      <div class="field">
        <label>How old are you?</label>
        <input type="text" class="fork" data-branching-fn="integerEval" name="person_age" placeholder="Age" />

        <!-- Level 1 form fields: children of person_age -->
        <div class="field hidden" data-parent-branch="person_age" data-show-on-value="gte-3_and_lte-7">
          <p class="info"><span class="level">Level 1</span> Person's age is <b>between 3 & 7</b></p>
          <label>What's your favorite candy?</b></label>
          <input type="text" class="fork" name="favorite_candy" data-branching-fn="stringEval" placeholder="Favorite candy" />

          <!-- Level 2 form fields: children of favorite_candy -->
          <div class="field hidden" data-parent-branch="favorite_candy" data-show-on-value=" StarBurst,skittles">
             <p class="info"><span class="level">Level 2</span> Person's favorite candy is <b>starburst</b></p>
            <label>What flavor?</b></label>
            <input type="text" name="what_flavor_starburst" placeholder="What flavor?" />
          </div>
          <div class="field hidden" data-parent-branch="favorite_candy" data-show-on-value="chocolate">
             <p class="info"><span class="level">Level 2</span> Person's favorite candy is <b>chocolate</b></p>
            <label>Which chocolate bar?</b></label>
            <input type="text" name="which_chocolate_bar" placeholder="Which chocolate bar?" />
          </div>
        </div>

        <!-- Level 1 form fields: children of person_age -->
        <div class="field hidden" data-parent-branch="person_age" data-show-on-value="5">
           <p class="info"><span class="level">Level 1</span> Person's age <b>equals 5</b></p>
          <label>Did you start kindergarden this year?</label>
          <input type="hidden" class="fork" name="started_kindergarden_this_year" data-branching-fn="stringEval" />
          <span class="custom-radio"> YES</span>
          <span class="custom-radio"> NO</span>

          <!-- Level 2 form fields: children of started_kindergarden_this_year -->
          <div class="field hidden" data-parent-branch="started_kindergarden_this_year" data-show-on-value="yes">
             <p class="info"><span class="level">Level 2</span> Person <b>did</b> start kindergarden this year</p>
            <label>What kindergarden do you go to?</b></label>
            <input type="text" name="what_kindergarden" />
          </div>
        </div>

        <!-- Level 1 form fields: children of person_age -->
        <div class="field hidden" data-parent-branch="person_age" data-show-on-value="gte-21">
          <p class="info"><span class="level">Level 1</span>Person's age is <b>at least 21</b></p>
          <label>Did you graduate college?</label>
          <input type="radio" class="fork" data-branching-fn="stringEval" name="graduated_college" value="1">Yes &nbsp;
          <input type="radio" class="fork" data-branching-fn="stringEval" name="graduated_college" value="2">No &nbsp;
          <input type="radio" class="fork" data-branching-fn="stringEval" name="graduated_college" value="3">Maybe

          <!-- Level 2 form fields: children of started_kindergarden_this_year -->
          <div class="field hidden" data-parent-branch="graduated_college" data-show-on-value="1">
             <p class="info"><span class="level">Level 2</span> Person <b>did</b> graduate college</p>
            <label>What college did you graduate from?</b></label>
            <input type="text" name="graduated_from" />
          </div>

          <div class="field hidden" data-parent-branch="graduated_college" data-show-on-value="2,3">
             <p class="info"><span class="level">Level 2</span> Person <b>did not</b> graduate college</p>
            <label>What college would you like to attend?</b></label>
            <input type="text" name="wants_to_graduate_from" />
          </div>
        </div>
      </div>

      <!-- Level 0 form field: person_income -->
      <div class="field">
        <label>What is your annual income?</label>
        <select class="fork" data-branching-fn="stringEval" name="person_income">
          <option value="under30">$0 - $30,000</option>
          <option value="between30and60">$30,000 - $60,000</option>
          <option value="between60and100">$60,000 - $100,000</option>
          <option value="morethan100">More than $100,000</option>
        </select>

        <!-- Level 1 form fields: children of person_income -->
        <div class="field hidden" data-parent-branch="person_income" data-show-on-value="morethan100">
          <p class="info"><span class="level">Level 1</span> Person earns <b>more than $100,000</b></p>
          <label>How does it feel to be rich?</label>
          <input type="text" name="being_rich" />
        </div>
      </div>
    </div>

    <div id="fake-submit-button">Submit</div>
    <div id="fake-post-data"></div>

    <script type="text/javascript" src="js/branching-form.js"></script>
    <script type="text/javascript">

      (function () {
        /* Instantiate new branching form object */
        var userFeedbackForm = new BranchingForm($('#branching-form'), $('#branching-form .fork'));

        /* Attach change event handler to monitor the values of our branch forks & evaluate them with the appropriate userFeedbackForm method */
        _.each(userFeedbackForm.forks, function (fork) {
          var branchMethod = $(fork).data('branching-fn'); // determine the type of evaluation we need to do on the input value
          if ($(fork).prop('type') === 'text') { $(fork).keyup(function() { $(fork).trigger('change'); }); }
          $(fork).change(function (e) {
            var childBranches = $('#branching-form').find('div[data-parent-branch=' + $(fork).prop('name') + ']'),
                userEnteredValue = $(fork).val();

            userFeedbackForm[branchMethod](childBranches, userEnteredValue);
          });
        });

        /* Attach click event handler for custom radios */
        $('#branching-form').find('div span.custom-radio').click(function(e) {
          userFeedbackForm.util.handleCustomRadios(e);
        });

        /* Stub submit button to display postData on form submit */
        $('#fake-submit-button').click(function(e) {
          var stringifiedPostData = userFeedbackForm.postData();
          stringifiedPostData = JSON.stringify(stringifiedPostData);
          var radioVal = $(userFeedbackForm).find('input[type=radio').val();
          $('#fake-post-data').html('<h2>Post Data on Submit:</h2>' + stringifiedPostData);
        });

      })();

    </script>
  </body>
</html>
